{% extends "users/db_base.html" %}
{% block title %}<title>SnapFlow : Event Setup</title>{% endblock %}



{% block sidebar %}

<li class="menu-item ">
   <a href="{% url 'users:dashboard' %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-home-circle"></i>
      <div data-i18n="Analytics">Dashboard</div>
   </a>
</li>
<li class="menu-header small text-uppercase">
   <span class="menu-header-text">Account</span>
</li>
<li class="menu-item">
   <a href="{% url 'users:profile' %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-dock-top"></i>
      <div>View Profile</div>
   </a>
</li>
<li class="menu-item">
   <a href="{% url 'notifications:list' %}" class="menu-link">
      <i class="bx bx-bell me-1"></i>
      <div>Notifications</div>
   </a>
</li>
<li class="menu-item">
   <a href="{% url 'users:connections' %}" class="menu-link">
      <i class="bx bx-link-alt me-1"></i>
      <div>Connections</div>
   </a>
</li>
{% if user.role != 'ORGANIZER' %}
<li class="menu-item">
   <a href="{% url 'photos:user_gallery' %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-photo-album"></i>
      <div>My Photos</div>
   </a>
</li>
{% endif %}
{% if user.role == 'ORGANIZER' %}
<li class="menu-header small text-uppercase">
   <span class="menu-header-text">Event Handle</span>
</li>
{% else %}
<li class="menu-header small text-uppercase">
   <span class="menu-header-text">Events</span>
</li>
{% endif %}
{% if user.role == 'ORGANIZER' %}
<li class="menu-item">
   <a href="{% url 'events:event_create' %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-calendar-event"></i>
      <div>Create Event</div>
   </a>
</li>
{% else %}
<li class="menu-item">
   <a href="{% url 'events:request_access_form' %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-photo-album"></i>
      <div>Join Events</div>
   </a>
</li>
{% endif %}


<li class="menu-item">
   <a href="{% url 'events:event_list' %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-cog"></i>
      <div>View Events</div>
   </a>
</li>

<li class="menu-item">
  <a href="{% url 'events:access_requests' %}" class="menu-link">
     <i class="menu-icon tf-icons bx bx-list-check"></i>
     <div>Event Requests</div>
  </a>
</li>
{% if user.role == 'ORGANIZER' %}
<li class="menu-item">
 <a href="{% url 'privacy:organizer_requests' %} " class="menu-link">
   <i class="menu-icon tf-icons bx bx-dock-top"></i>
   <div>Privacy Requests</div>
 </a>
</li>
{% endif %}


<li class="menu-header small text-uppercase">
  <span class="menu-header-text">Event Details</span>
</li>
<li class="menu-item">
  <a href="{% url 'events:event_dashboard' event.slug %} " class="menu-link">
  <i class="menu-icon tf-icons bx bx-dock-top"></i>
  <div>Event Dashboard</div>
  </a>
</li>
<li class="menu-item">
  <a href="{% url 'highlights:event_highlights' event.slug %} " class="menu-link">
  <i class="menu-icon tf-icons bx bx-dock-top"></i>
  <div>Event Highlights</div>
  </a>
</li>
<li class="menu-item">
  <a href="{% url 'photos:event_gallery' event.slug %} " class="menu-link">
    <i class="menu-icon tf-icons bx bx-dock-top"></i>
    <div>View Gallery</div>
  </a>
</li>



<li class="menu-header small text-uppercase">
  <span class="menu-header-text">Event Settings</span>
</li>
{% if user.role == 'ORGANIZER' %}
<li class="menu-item active">
  <a href="{% url 'events:event_setup' event.slug 'privacy' %}" class="menu-link">
  <i class="menu-icon tf-icons bx bx-dock-top"></i>
  <div>Event Configuration</div>
  </a>
</li>
<li class="menu-item ">
    <a href="{% url 'events:equipment_config' event.slug %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-cog"></i>
      <div>Equipment Config </div>
    </a>
  </li>


  
  {% if user.role == 'ORGANIZER' %}
  <li class="menu-item">
    <a href="{% url 'quick_registration:manage_links' event.slug %}" class="menu-link">
      <i class="menu-icon tf-icons bx bx-cog"></i>
      <div>Manage Links</div>
    </a>
  </li>
{% endif %}
<li class="menu-item">
  <a href="{% url 'events:crew_management' event.slug %}" class="menu-link">
    <i class="menu-icon tf-icons bx bx-cog"></i>
    <div>Manage Crew</div>
  </a>
</li>

<li class="menu-item">
  <a href="{% url 'events:event_participants' event.slug %}" class="menu-link">
    <i class="menu-icon tf-icons bx bx-cog"></i>
    <div>View Participants</div>
  </a>
</li>
{% endif %}

{% if user.role == "PHOTOGRAPHER" %}
<li class="menu-item  ">
  <a href="{% url 'events:equipment_config' event.slug %}" class="menu-link">
    <i class="menu-icon tf-icons bx bx-cog"></i>
    <div>Equipment Config</div>
  </a>
</li>
{% endif %}

{% if user.role == "ORGANIZER" %}
<li class="menu-item">
  <a href="{% url 'events:manage_gallery_access' event.slug %}" class="menu-link">
    <i class="menu-icon tf-icons bx bx-cog"></i>
    <div>Gallery Requests</div>
  </a>
</li>
<li class="menu-item">
  <a href="{% url 'privacy:event_requests' event.slug %}" class="menu-link">
    <i class="menu-icon tf-icons bx bx-cog"></i>
    <div>Privacy requests</div>
  </a>
</li>
{% endif %}
{% endblock sidebar %}




{% block content %}
<div class="container-xxl flex-grow-1 container-p-y">
  <h4 class="fw-bold py-3 mb-4">
    <span class="text-muted fw-light">Events /</span> Setup: {{ event.title }}
  </h4>

  <div class="row">
    <div class="col-12">
      <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
          <h5 class="mb-0">Configure Event</h5>
        </div>
        
        <!-- Progress steps navigation -->
        <div class="card-body pb-0">
          <div class="d-flex flex-wrap gap-2 mb-4">
            {% for step in steps %}
            <a href="{% url 'events:event_setup' event.slug step %}" 
               class="btn {% if step == current_step %}btn-primary{% else %}btn-outline-secondary{% endif %}">
                {{ step|title }}
            </a>
            {% endfor %}
          </div>
        </div>

        <!-- Form content -->
        <div class="card-body">
          <form method="post" enctype="multipart/form-data" class="row g-3">
            {% csrf_token %}
            
            {% for field in form %}
            <div class="col-md-12 mb-3">
              {% if field.field.widget.input_type == 'checkbox' %}
                <div class="form-check form-switch">
                  {{ field }}
                  <label class="form-check-label" for="{{ field.id_for_label }}">
                    {{ field.label }}
                  </label>
                </div>
              {% elif field.name == 'allowed_formats' %}
                <label class="form-label">{{ field.label }}</label>
                <div class="d-flex gap-3">
                  {{ field }}
                </div>
              {% elif field.field.widget.input_type == 'color' %}
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                <div class="input-group">
                  {{ field }}
                  <span class="input-group-text">
                    <i class="bx bx-palette"></i>
                  </span>
                </div>
              {% elif field.field.widget.input_type == 'select' or field.field.widget.input_type == 'selectmultiple' %}
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                <select class="form-select" id="{{ field.id_for_label }}" name="{{ field.html_name }}" 
                  {% if field.field.required %}required{% endif %}
                  {% if field.field.widget.input_type == 'selectmultiple' %}multiple{% endif %}>
                  {% for option in field %}
                    {{ option }}
                  {% endfor %}
                </select>
              {% elif field.field.widget.input_type == 'file' %}
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                <input class="form-control" type="file" id="{{ field.id_for_label }}" name="{{ field.html_name }}" 
                  {% if field.field.required %}required{% endif %}>
              {% elif field.field.widget.input_type == 'textarea' %}
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                <textarea class="form-control" id="{{ field.id_for_label }}" name="{{ field.html_name }}" 
                  rows="3" {% if field.field.required %}required{% endif %}></textarea>
              {% else %}
                <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
                <input type="{{ field.field.widget.input_type|default:'text' }}" 
                  class="form-control" 
                  id="{{ field.id_for_label }}" 
                  name="{{ field.html_name }}" 
                  value="{{ field.value|default:'' }}"
                  {% if field.field.required %}required{% endif %}>
              {% endif %}
              
              {% if field.errors %}
              <div class="text-danger">
                {% for error in field.errors %}
                <small>{{ error }}</small>
                {% endfor %}
              </div>
              {% endif %}
              
              {% if field.help_text %}
              <div id="{{ field.id_for_label }}Help" class="form-text">
                {{ field.help_text }}
              </div>
              {% endif %}
            </div>
            {% endfor %}

            <!-- Form navigation buttons -->
            <div class="d-flex justify-content-between mt-4">
              {% if previous_step %}
              <a href="{% url 'events:event_setup' event.slug previous_step %}" 
                 class="btn btn-outline-secondary">
                <i class="bx bx-chevron-left"></i> Previous
              </a>
              {% else %}
              <div></div> <!-- Empty div to maintain the flex spacing -->
              {% endif %}
              
              <button type="submit" class="btn btn-primary">
                {% if next_step %}
                Next <i class="bx bx-chevron-right"></i>
                {% else %}
                Complete Setup <i class="bx bx-check"></i>
                {% endif %}
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}