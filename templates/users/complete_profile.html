{% extends "users/auth_base.html" %}
{% load static %}

{% block title %}Complete Profile - Your App{% endblock %}

{% block body_block %}
<div class="container-xxl">
    <div class="authentication-wrapper authentication-basic container-p-y">
        <div class="authentication-inner">
            <div class="card">
                <div class="card-body">
                    <div class="app-brand justify-content-center">
                        <a href="{% url 'home:landing' %}" class="app-brand-link gap-2">
                            <span class="app-brand-text demo text-body fw-bolder">SnapFlow</span>
                        </a>
                    </div>
                    <h4 class="mb-2">Complete Your Profile</h4>
                    <p class="mb-4">Fill in the required details to complete your account setup.</p>

                    <!-- Display Django Messages -->
                    {% if messages %}
                    <div class="container mt-3">
                        {% for message in messages %}
                        <div class="alert {% if message.tags %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <form method="POST" enctype="multipart/form-data" class="mb-3">
                        {% csrf_token %}

                        <!-- Avatar Upload -->
                        <div class="mb-3">
                            <label class="form-label">Profile Picture</label>
                            <input type="file" class="form-control" name="avatar">
                        </div>

                        <!-- Phone Number -->
                        <div class="mb-3">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-control" name="phone_number" placeholder="Enter your phone number" value="{{ form.phone_number.value|default:'' }}" />
                        </div>

                        <!-- Role-Specific Fields -->
                        {% if user.role == 'ORGANIZER' %}
                        <div class="mb-3">
                            <label class="form-label">Company Name</label>
                            <input type="text" class="form-control" name="company_name" placeholder="Company Name" value="{{ form.company_name.value|default:'' }}" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Website URL</label>
                            <input type="url" class="form-control" name="website" placeholder="Website URL" value="{{ form.website.value|default:'' }}" />
                        </div>
                        {% endif %}

                        {% if user.role == 'PHOTOGRAPHER' %}
                        <div class="mb-3">
                            <label class="form-label">Portfolio URL</label>
                            <input type="url" class="form-control" name="portfolio_url" placeholder="Portfolio URL" value="{{ form.portfolio_url.value|default:'' }}" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Photography Role</label>
                            <select class="form-control" name="photographer_role">
                                <option value="" disabled {% if not form.photographer_role.value %}selected{% endif %}>Select Role</option>
                                {% for value, label in form.photographer_role.field.choices %}
                                    <option value="{{ value }}" {% if value == form.photographer_role.value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Use Watermark?</label>
                            {{ form.watermark }}
                        </div>
                        {% endif %}

                        {% if user.role == 'PARTICIPANT' %}
                        <div class="mb-3">
                            <label class="form-label">Participant Type</label>
                            <select class="form-control" name="participant_type">
                                <option value="" disabled {% if not form.participant_type.value %}selected{% endif %}>Select Type</option>
                                {% for value, label in form.participant_type.field.choices %}
                                    <option value="{{ value }}" {% if value == form.participant_type.value %}selected{% endif %}>{{ label }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Image Visibility</label>
                            <select class="form-control" name="image_visibility">
                                <option value="PUBLIC" {% if form.image_visibility.value == 'PUBLIC' %}selected{% endif %}>Public</option>
                                <option value="PRIVATE" {% if form.image_visibility.value == 'PRIVATE' %}selected{% endif %}>Private</option>
                                <option value="EVENT_ONLY" {% if form.image_visibility.value == 'EVENT_ONLY' %}selected{% endif %}>Event Only</option>
                            </select>
                        </div>
                        <div class="mb-3 form-check">
                            <input class="form-check-input" type="checkbox" name="blur_requested" {% if form.blur_requested.value %}checked{% endif %} />
                            <label class="form-check-label">Request Face Blur in Photos</label>
                        </div>
                        <div class="mb-3 form-check">
                            <input class="form-check-input" type="checkbox" name="remove_requested" {% if form.remove_requested.value %}checked{% endif %} />
                            <label class="form-check-label">Request Photo Removal Option</label>
                        </div>
                        {% endif %}

                        <!-- Non-Field Errors -->
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                <p class="error-message">{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <button type="submit" class="btn btn-primary d-grid w-100">Complete Profile</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
